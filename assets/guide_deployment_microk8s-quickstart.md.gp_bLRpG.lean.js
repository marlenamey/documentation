import{_ as i}from"./chunks/logical_volumes.BP0lHkdc.js";import{_ as a,c as e,a0 as t,o as n}from"./chunks/framework.BGabeMLJ.js";const u=JSON.parse('{"title":"Getting Started with microk8s and Helm","description":"","frontmatter":{},"headers":[],"relativePath":"guide/deployment/microk8s-quickstart.md","filePath":"guide/deployment/microk8s-quickstart.md"}'),h={name:"guide/deployment/microk8s-quickstart.md"};function l(o,s,p,r,d,k){return n(),e("div",null,s[0]||(s[0]=[t(`<h1 id="getting-started-with-microk8s-and-helm" tabindex="-1">Getting Started with microk8s and Helm <a class="header-anchor" href="#getting-started-with-microk8s-and-helm" aria-label="Permalink to &quot;Getting Started with microk8s and Helm&quot;">​</a></h1><p>This guide demonstrates how to get microk8s and Helm running on a debian-based server (e.g. ubuntu).</p><h2 id="install-microk8s-and-helm" tabindex="-1">Install microk8s and Helm <a class="header-anchor" href="#install-microk8s-and-helm" aria-label="Permalink to &quot;Install microk8s and Helm&quot;">​</a></h2><h3 id="update-system-packages" tabindex="-1">Update System Packages <a class="header-anchor" href="#update-system-packages" aria-label="Permalink to &quot;Update System Packages&quot;">​</a></h3><p>Assuming you are working with a freshly installed OS, be sure to first update the system packages before proceeding:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div><h3 id="install-snap" tabindex="-1">Install snap <a class="header-anchor" href="#install-snap" aria-label="Permalink to &quot;Install snap&quot;">​</a></h3><p>We will use the snap package manager for installing and managing microk8s. First, install the snap daemon</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> snapd</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>You may be asked during installation about which timezone you are in. This can occur twice, once for the region and once for a city. For both, enter the number corresponding to the option that <em>best</em> fits your location and press <code>Enter</code> to continue with installation.</p></div><p>Before continuing, check whether you can run commands using snap by executing <code>snap list</code>. If this returns an error, then the snap executable needs to be added to the <code>PATH</code> environment variable. This can be done easily be running the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;export PATH=$PATH:/snap/bin&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span></span></code></pre></div><h3 id="use-snap-to-install-microk8s" tabindex="-1">Use snap to install microk8s <a class="header-anchor" href="#use-snap-to-install-microk8s" aria-label="Permalink to &quot;Use snap to install microk8s&quot;">​</a></h3><p>Next, install the <code>core</code> dependency along with microk8s using snap:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> snap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> core</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> snap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> microk8s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --classic</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --channel=1.32</span></span></code></pre></div><p>Verify you can run microk8s:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If you see a message saying <code>Insufficient permissions to access MicroK8s.</code>, then visit <a href="#fixing-microk8s-permissions">fixing microk8s permissions</a> in the <a href="#troubleshooting">Troubleshooting</a> section.</p></div><h3 id="install-helm" tabindex="-1">Install Helm <a class="header-anchor" href="#install-helm" aria-label="Permalink to &quot;Install Helm&quot;">​</a></h3><p>We will install helm using its install script that we can get using <code>curl</code>. First install <code>curl</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span></span></code></pre></div><p>Install Helm:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get_helm.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 700</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get_helm.sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./get_helm.sh</span></span></code></pre></div><h2 id="setup-microk8s" tabindex="-1">Setup microk8s <a class="header-anchor" href="#setup-microk8s" aria-label="Permalink to &quot;Setup microk8s&quot;">​</a></h2><h3 id="update-storage-location" tabindex="-1">Update Storage Location <a class="header-anchor" href="#update-storage-location" aria-label="Permalink to &quot;Update Storage Location&quot;">​</a></h3><p>Because we need to be able to download and store several container images, we need to ensure that there is enough disk space available. By default, microk8s will store everything on your root file system located at <code>/</code>. Depending on how your server was setup, bulk storage may be located on a different logical volume (LV) than your root file system. You can check this by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">df</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span></code></pre></div><figure style="margin:3em 0 3em 0;"><img src="`+i+`" style="display:block;margin:auto;" alt="LV sizes"><figcaption style="text-align:center;"><b>Example output</b>. Here the root file system, installed at <code>/</code> (yellow arrow) only has 13GB available, but a different LV mounted at <code>/mnt/vdb1</code> (green arrow) has 435GB.</figcaption></figure><p>If you need to use a different LV for storage, replace <code>&lt;new mount&gt;</code> in the following command with the mount path of the LV you want to use for storage and then execute the command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/snap/microk8s/current/args/containerd</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--config </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{SNAP_DATA}/args/containerd.toml</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--root &lt;new mount&gt;/var/lib/containerd</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--state &lt;new mount&gt;/run/containerd</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--address </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{SNAP_COMMON}/run/containerd.sock</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><p>For the example above, we would replace <code>&lt;new mount&gt;</code> with <code>/mnt/vdb1</code>.</p><p>Restart microk8s to apply this change:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> snap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> microk8s</span></span></code></pre></div><h3 id="generate-the-configuration" tabindex="-1">Generate the Configuration <a class="header-anchor" href="#generate-the-configuration" aria-label="Permalink to &quot;Generate the Configuration&quot;">​</a></h3><p>Now create a folder for the microk8s configuration at <code>~/.kube</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.kube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0700</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.kube</span></span></code></pre></div><p>Generate a configuration file and store it in this new folder:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> view</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --raw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.kube/config</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can shorten the command for interacting with the k8s API by creating an alias:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;alias kubectl=&#39;microk8s kubectl&#39;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span></span></code></pre></div></div><p>This configuration is required for Helm to work properly. Check whether Helm can contact the microk8s API by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If you see a message saying <code>Error: Kubernetes cluster unreachable: Get &quot;http://localhost:8080/version&quot;: dial tcp 127.0.0.1:8080: connect: connection refused</code>, then try the following:</p><ul><li>Ensure you have permission to read/write the <code>.kube/</code> folder: <code>chown -f -R $USER ~/.kube</code></li><li>Regenerate the microk8s configuration file: <code>microk8s kubectl config view --raw &gt; ~/.kube/config</code></li></ul></div><h3 id="install-required-addons" tabindex="-1">Install Required Addons <a class="header-anchor" href="#install-required-addons" aria-label="Permalink to &quot;Install Required Addons&quot;">​</a></h3><p>Several features which are required by the flame node software can be enabled in microk8s through its &quot;addons&quot;. Run the following to activate these addons:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dashboard</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ingress</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hostpath-storage</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metrics-server</span></span></code></pre></div><h2 id="final-checks" tabindex="-1">Final Checks <a class="header-anchor" href="#final-checks" aria-label="Permalink to &quot;Final Checks&quot;">​</a></h2><p>Ensure that you can run the following without errors</p><table tabindex="0"><thead><tr><th>Service</th><th>Command</th><th>Expected Output</th><th>Troubleshooting Step</th></tr></thead><tbody><tr><td>microk8s</td><td><code>microk8s version</code></td><td><code>MicroK8s v1.32.3 revision 8148</code></td><td>Check whether the current user is part of the <code>microk8s</code> group: <code>groups</code> If not, then end the current session and log back in or run <code>newgrp microk8s</code></td></tr><tr><td>ingress</td><td><code>microk8s status</code></td><td><code>enabled: &lt;br&gt;...&lt;br&gt;ingress</code></td><td>Enable ingress addon: <code>microk8s enable ingress</code></td></tr><tr><td>hostpath-storage</td><td><code>microk8s status</code></td><td><code>enabled: &lt;br&gt;...&lt;br&gt;hostpath-storage</code></td><td>Enable ingress addon: <code>microk8s enable hostpath-storage</code></td></tr><tr><td>helm</td><td><code>helm list</code></td><td><code>NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION</code></td><td>Go through the steps in the <a href="#generate-the-configuration">Generating the Configuration</a> section</td></tr></tbody></table><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="fixing-microk8s-permissions" tabindex="-1">Fixing microk8s permissions <a class="header-anchor" href="#fixing-microk8s-permissions" aria-label="Permalink to &quot;Fixing microk8s permissions&quot;">​</a></h3><p>The default user for your server needs to be added to the &quot;microk8s&quot; group to execute commands for the microk8s service. Run the following to add the current user to the group:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> usermod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> microk8s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $USER</span></span></code></pre></div><p>Then you need to reload the user groups by either rebooting or running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newgrp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> microk8s</span></span></code></pre></div><p>Finally, check if you have sufficient permissions to interact with microk8s:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">microk8s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span></code></pre></div>`,56)]))}const F=a(h,[["render",l]]);export{u as __pageData,F as default};
